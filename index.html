<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Warung Habibie</title>

    <!-- Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      /* ========== VARIABLES & RESET ========== */
      :root {
        --primary: #ff6b35;
        --primary-dark: #e55a2b;
        --secondary: #6c63ff;
        --dark: #1a1a2e;
        --dark-light: #2d2d44;
        --light: #f8f9fa;
        --gray: #8a8aa0;
        --success: #28a745;
        --warning: #ffc107;
        --danger: #dc3545;
        --info: #17a2b8;
        
        --gradient-primary: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
        --gradient-dark: linear-gradient(135deg, #1a1a2e 0%, #2d2d44 100%);
        --gradient-secondary: linear-gradient(135deg, #6c63ff 0%, #8a84ff 100%);
        
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
        --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.12);
        --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.16);
        --shadow-xl: 0 12px 48px rgba(0, 0, 0, 0.2);
        
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 24px;
        
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', sans-serif;
        background: #f5f7fb;
        color: #333;
        min-height: 100vh;
        overflow-x: hidden;
      }

      h1, h2, h3, h4, h5, h6 {
        font-family: 'Poppins', sans-serif;
        font-weight: 600;
      }

      /* ========== DASHBOARD LAYOUT ========== */
      .dashboard-page {
        display: block;
      }

      /* ========== MOBILE MENU BUTTON ========== */
      .mobile-menu-btn {
        display: none;
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1001;
        background: var(--gradient-primary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        padding: 12px;
        font-size: 1.2rem;
        cursor: pointer;
        box-shadow: var(--shadow-lg);
        transition: var(--transition);
      }

      .mobile-menu-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-xl);
      }

      /* ========== SIDEBAR ========== */
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        width: 280px;
        height: 100vh;
        background: var(--dark);
        background: var(--gradient-dark);
        color: white;
        padding: 30px 0;
        z-index: 1000;
        overflow-y: auto;
        transition: var(--transition);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
      }

      .sidebar::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 100%;
        background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.02' fill-rule='evenodd'/%3E%3C/svg%3E");
        opacity: 0.1;
      }

      .sidebar.mobile-open {
        transform: translateX(0);
      }

      .logo {
        padding: 0 30px 40px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 30px;
      }

      .logo h2 {
        color: white;
        font-size: 1.8rem;
        display: flex;
        align-items: center;
        gap: 12px;
        justify-content: center;
      }

      .logo h2 i {
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 2rem;
      }

      .logo .tagline {
        font-size: 0.85rem;
        color: var(--gray);
        margin-top: 5px;
        font-weight: 300;
      }

      .nav-menu {
        list-style: none;
        padding: 0 20px;
      }

      .nav-menu li {
        margin-bottom: 8px;
      }

      .nav-menu a {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 14px 20px;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        border-radius: var(--radius-md);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .nav-menu a::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 4px;
        background: var(--primary);
        transform: translateX(-100%);
        transition: var(--transition);
      }

      .nav-menu a:hover {
        background: rgba(255, 255, 255, 0.05);
        color: white;
        transform: translateX(5px);
      }

      .nav-menu a:hover::before {
        transform: translateX(0);
      }

      .nav-menu a.active {
        background: rgba(255, 107, 53, 0.15);
        color: white;
        box-shadow: var(--shadow-sm);
      }

      .nav-menu a.active::before {
        transform: translateX(0);
      }

      .nav-menu a.active i {
        color: var(--primary);
      }

      .nav-menu i {
        width: 24px;
        text-align: center;
        font-size: 1.2rem;
        transition: var(--transition);
      }

      .user-info {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 25px;
        background: rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
      }

      .user-info .user-details {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 15px;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: white;
        font-size: 1.2rem;
      }

      .user-text h4 {
        font-size: 1rem;
        color: white;
        margin-bottom: 2px;
      }

      .user-text p {
        font-size: 0.85rem;
        color: var(--gray);
      }

      /* ========== MAIN CONTENT ========== */
      .main-content {
        margin-left: 280px;
        padding: 30px;
        min-height: 100vh;
        transition: var(--transition);
      }

      .header {
        background: white;
        padding: 30px;
        border-radius: var(--radius-xl);
        margin-bottom: 30px;
        box-shadow: var(--shadow-lg);
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--gradient-primary);
      }

      .header h1 {
        color: var(--dark);
        font-size: 2rem;
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .header h1 i {
        color: var(--primary);
        background: rgba(255, 107, 53, 0.1);
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
      }

      .header .subtitle {
        color: var(--gray);
        margin-top: 10px;
        font-size: 1rem;
        font-weight: 400;
      }

      /* ========== CARDS GRID ========== */
      .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
      }

      .card {
        background: white;
        border-radius: var(--radius-xl);
        padding: 30px;
        box-shadow: var(--shadow-md);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-xl);
      }

      .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--gradient-primary);
        opacity: 0;
        transition: var(--transition);
      }

      .card:hover::before {
        opacity: 1;
      }

      .card h2 {
        font-size: 1.4rem;
        margin-bottom: 25px;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .card h2 i {
        color: var(--primary);
        background: rgba(255, 107, 53, 0.1);
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
      }

      /* ========== STORE STATUS CARD ========== */
      .status-display {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 30px;
        background: rgba(255, 107, 53, 0.05);
        padding: 20px;
        border-radius: var(--radius-lg);
      }

      .status-content {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .status-indicator {
        padding: 10px 24px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.95rem;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: var(--shadow-sm);
      }

      .status-indicator::before {
        content: '';
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: currentColor;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      .status-open {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
        border: 2px solid #15572420;
      }

      .status-closed {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
        border: 2px solid #721c2420;
      }

      .toggle-btn {
        padding: 12px 28px;
        background: var(--gradient-primary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        cursor: pointer;
        font-weight: 600;
        font-size: 0.95rem;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: var(--shadow-md);
      }

      .toggle-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .toggle-btn:active {
        transform: translateY(0);
      }

      .toggle-btn:disabled {
        background: #cccccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      /* ========== FORM STYLES ========== */
      .form-group {
        margin-bottom: 24px;
      }

      .form-group label {
        display: block;
        margin-bottom: 10px;
        font-weight: 500;
        color: var(--dark);
        font-size: 0.95rem;
      }

      .form-control {
        width: 100%;
        padding: 14px 18px;
        border: 2px solid #e9ecef;
        border-radius: var(--radius-md);
        font-size: 1rem;
        transition: var(--transition);
        background: white;
        color: var(--dark);
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
      }

      .form-control::placeholder {
        color: #adb5bd;
      }

      select.form-control {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%238a8aa0' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 18px center;
        padding-right: 50px;
      }

      textarea.form-control {
        min-height: 120px;
        resize: vertical;
      }

      /* ========== STATS CARD ========== */
      .stats-card {
        text-align: center;
      }

      .stats-main {
        font-size: 3.5rem;
        font-weight: 700;
        color: var(--primary);
        margin: 20px 0;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        line-height: 1;
      }

      .stats-label {
        color: var(--gray);
        font-size: 1rem;
        margin-bottom: 25px;
      }

      .stats-details {
        display: flex;
        justify-content: space-around;
        margin-top: 30px;
        padding-top: 25px;
        border-top: 2px dashed #e9ecef;
      }

      .stat-item {
        text-align: center;
      }

      .stat-value {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 5px;
      }

      .stat-value.positive {
        color: var(--success);
      }

      .stat-value.negative {
        color: var(--danger);
      }

      .stat-label {
        font-size: 0.9rem;
        color: var(--gray);
      }

      /* ========== MENU TABLE ========== */
      .table-container {
        overflow-x: auto;
        margin-top: 20px;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
      }

      table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        background: white;
        border-radius: var(--radius-lg);
        overflow: hidden;
      }

      thead {
        background: var(--gradient-dark);
      }

      th {
        padding: 18px 20px;
        text-align: left;
        font-weight: 600;
        color: white;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      tbody tr {
        transition: var(--transition);
      }

      tbody tr:hover {
        background: rgba(255, 107, 53, 0.03);
        transform: translateY(-2px);
      }

      td {
        padding: 18px 20px;
        border-bottom: 1px solid #e9ecef;
        color: var(--dark);
        font-weight: 500;
      }

      tbody tr:last-child td {
        border-bottom: none;
      }

      .stock-badge {
        padding: 6px 14px;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 600;
        display: inline-block;
        min-width: 70px;
        text-align: center;
      }

      .stock-low {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        color: #856404;
        border: 2px solid #85640420;
      }

      .stock-ok {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
        border: 2px solid #15572420;
      }

      .stock-out {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
        border: 2px solid #721c2420;
      }

      .action-buttons {
        display: flex;
        gap: 10px;
      }

      .btn-edit,
      .btn-delete {
        padding: 8px 16px;
        border: none;
        border-radius: var(--radius-md);
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 6px;
        min-width: 80px;
        justify-content: center;
      }

      .btn-edit {
        background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
        color: #333;
      }

      .btn-edit:hover {
        background: linear-gradient(135deg, #ffb300 0%, #ffa000 100%);
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
      }

      .btn-delete {
        background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        color: white;
      }

      .btn-delete:hover {
        background: linear-gradient(135deg, #d32f2f 0%, #c62828 100%);
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
      }

      /* ========== ADD MENU FORM ========== */
      .add-menu-form {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 30px;
        border-radius: var(--radius-xl);
        margin-top: 30px;
        border: 2px dashed #dee2e6;
      }

      .add-menu-form h3 {
        margin-bottom: 25px;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.3rem;
      }

      .add-menu-form h3 i {
        color: var(--primary);
        background: white;
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        box-shadow: var(--shadow-sm);
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      .form-actions {
        margin-top: 30px;
        text-align: right;
      }

      .btn-submit {
        padding: 15px 35px;
        background: var(--gradient-primary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 10px;
        margin-left: auto;
        box-shadow: var(--shadow-md);
      }

      .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      /* ========== FILE UPLOAD STYLING ========== */
      .file-upload-container {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 15px;
      }

      .file-upload-btn {
        padding: 14px 20px;
        background: var(--gradient-secondary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        cursor: pointer;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: var(--transition);
        width: 100%;
        font-weight: 500;
      }

      .file-upload-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .file-upload-btn:disabled {
        background: #cccccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .upload-progress {
        margin-top: 15px;
        background: #f0f0f0;
        border-radius: 50px;
        overflow: hidden;
        height: 24px;
        display: none;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .progress-bar {
        height: 100%;
        background: var(--gradient-primary);
        width: 0%;
        transition: width 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.85rem;
        font-weight: 600;
      }

      #fileName, #editFileName {
        font-size: 0.9rem;
        color: var(--gray);
        margin-top: 5px;
        padding: 8px 12px;
        background: white;
        border-radius: var(--radius-md);
        border: 2px dashed #dee2e6;
      }

      #imagePreview, #editImagePreview {
        margin-top: 15px;
        display: none;
      }

      #previewImage, #editPreviewImage {
        max-width: 200px;
        max-height: 200px;
        border-radius: var(--radius-md);
        border: 3px solid white;
        box-shadow: var(--shadow-md);
      }

      .image-options {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 15px;
      }

      .image-option-separator {
        text-align: center;
        color: var(--gray);
        font-size: 0.9rem;
        margin: 20px 0;
        position: relative;
        font-weight: 500;
      }

      .image-option-separator::before,
      .image-option-separator::after {
        content: '';
        position: absolute;
        top: 50%;
        width: 45%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #dee2e6, transparent);
      }

      .image-option-separator::before {
        left: 0;
      }

      .image-option-separator::after {
        right: 0;
      }

      /* ========== MODAL ========== */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1100;
        align-items: center;
        justify-content: center;
        padding: 20px;
        backdrop-filter: blur(5px);
      }

      .modal.show {
        display: flex;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      .modal-content {
        background: white;
        border-radius: var(--radius-xl);
        width: 100%;
        max-width: 550px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-xl);
        animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal-header {
        padding: 25px 30px;
        border-bottom: 2px solid #f1f3f5;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--gradient-dark);
        color: white;
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
      }

      .modal-header h3 {
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .modal-header h3 i {
        color: var(--primary);
      }

      .modal-body {
        padding: 30px;
      }

      .modal-footer {
        padding: 25px 30px;
        border-top: 2px solid #f1f3f5;
        text-align: right;
        display: flex;
        gap: 15px;
        justify-content: flex-end;
        background: #f8f9fa;
        border-radius: 0 0 var(--radius-xl) var(--radius-xl);
      }

      .btn-close {
        background: none;
        border: none;
        font-size: 1.8rem;
        cursor: pointer;
        color: rgba(255, 255, 255, 0.7);
        transition: var(--transition);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .btn-close:hover {
        color: white;
        background: rgba(255, 255, 255, 0.1);
      }

      /* ========== LOADING ========== */
      .loading {
        text-align: center;
        padding: 60px 20px;
        color: var(--gray);
      }

      .loading i {
        font-size: 3rem;
        margin-bottom: 20px;
        color: var(--primary);
        animation: spin 1.5s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* ========== ALERTS ========== */
      .alert {
        padding: 18px 24px;
        border-radius: var(--radius-md);
        margin-bottom: 25px;
        font-size: 0.95rem;
        display: none;
        animation: slideIn 0.3s ease;
        border-left: 4px solid;
        box-shadow: var(--shadow-sm);
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .alert-success {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
        border-color: #155724;
      }

      .alert-error {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
        border-color: #721c24;
      }

      /* ========== RESPONSIVE ========== */
      @media (max-width: 1200px) {
        .cards-grid {
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
      }

      @media (max-width: 1024px) {
        .sidebar {
          transform: translateX(-100%);
          width: 300px;
        }

        .sidebar.mobile-open {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
          padding: 80px 20px 20px;
        }

        .mobile-menu-btn {
          display: block;
        }

        .header {
          margin-top: 10px;
        }
      }

      @media (max-width: 768px) {
        .cards-grid {
          grid-template-columns: 1fr;
        }

        .header {
          padding: 25px;
        }

        .header h1 {
          font-size: 1.6rem;
        }

        .card {
          padding: 25px;
        }

        .card h2 {
          font-size: 1.3rem;
        }

        .status-display {
          flex-direction: column;
          align-items: stretch;
          gap: 15px;
        }

        .status-content {
          justify-content: space-between;
        }

        .toggle-btn {
          width: 100%;
          justify-content: center;
        }

        .action-buttons {
          flex-direction: column;
          width: 100%;
        }

        .btn-edit,
        .btn-delete {
          width: 100%;
          text-align: center;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .modal-content {
          width: 95%;
          max-height: 85vh;
        }

        .form-actions {
          text-align: center;
        }

        .btn-submit {
          width: 100%;
        }

        .modal-footer {
          flex-direction: column;
        }

        .modal-footer button {
          width: 100%;
        }

        .mobile-menu-btn {
          top: 15px;
          left: 15px;
        }
      }

      @media (max-width: 480px) {
        .main-content {
          padding: 70px 15px 15px;
        }

        .header h1 {
          font-size: 1.4rem;
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .header h1 i {
          width: 50px;
          height: 50px;
          font-size: 1.3rem;
        }

        .stats-main {
          font-size: 2.8rem;
        }

        .stats-details {
          flex-direction: column;
          gap: 15px;
        }

        .table-container {
          margin-left: -15px;
          margin-right: -15px;
          width: calc(100% + 30px);
        }

        table {
          min-width: 800px;
        }

        .add-menu-form {
          padding: 20px;
        }

        .file-upload-btn {
          padding: 12px;
          font-size: 0.9rem;
        }

        .modal-body {
          padding: 20px;
        }
      }

      @media (max-width: 360px) {
        .mobile-menu-btn {
          padding: 10px;
          font-size: 1rem;
        }

        .main-content {
          padding: 60px 10px 10px;
        }

        .card {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <!-- MOBILE MENU BUTTON -->
    <button id="mobileMenuBtn" class="mobile-menu-btn">
      <i class="fas fa-bars"></i>
    </button>

    <!-- DASHBOARD PAGE -->
    <div id="dashboardPage" class="dashboard-page">
      <!-- SIDEBAR -->
      <div class="sidebar" id="sidebar">
        <div class="logo">
          <h2><i class="fas fa-store"></i> Warung Habibie</h2>
          <p class="tagline">Admin Dashboard</p>
        </div>

        <ul class="nav-menu">
          <li>
            <a href="#" class="active" data-page="dashboard">
              <i class="fas fa-tachometer-alt"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <li>
            <a href="#" data-page="store">
              <i class="fas fa-cog"></i>
              <span>Pengaturan Toko</span>
            </a>
          </li>
          <li>
            <a href="#" data-page="menus">
              <i class="fas fa-utensils"></i>
              <span>Kelola Menu</span>
            </a>
          </li>
          <li>
            <a href="#" data-page="orders">
              <i class="fas fa-shopping-cart"></i>
              <span>Pesanan</span>
            </a>
          </li>
          <li>
            <a href="#" data-page="analytics">
              <i class="fas fa-chart-line"></i>
              <span>Analytics</span>
            </a>
          </li>
        </ul>

        <div class="user-info">
          <div class="user-details">
            <div class="user-avatar">WH</div>
            <div class="user-text">
              <h4>Administrator</h4>
              <p>Super Admin</p>
            </div>
          </div>
        </div>
      </div>

      <!-- MAIN CONTENT -->
      <div class="main-content">
        <!-- DASHBOARD PAGE -->
        <div id="pageDashboard" class="page" style="display: block">
          <div class="header">
            <h1><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h1>
            <p class="subtitle">Selamat datang! Kelola warung Anda dengan mudah</p>
          </div>

          <div id="dashboardAlert" class="alert" style="display: none"></div>

          <div class="cards-grid">
            <!-- Store Status Card -->
            <div class="card">
              <h2><i class="fas fa-store"></i> Status Toko</h2>
              <div class="status-display">
                <div class="status-content">
                  <div id="currentStatus" class="status-indicator status-open">
                    BUKA
                  </div>
                  <div>
                    <small style="color: var(--gray); display: block; margin-top: 5px;">Mode: <span id="currentMode">Otomatis</span></small>
                  </div>
                </div>
                <button id="toggleStatusBtn" class="toggle-btn">
                  <i class="fas fa-power-off"></i> Tutup Toko
                </button>
              </div>
              <div class="form-group">
                <label>Mode Operasi</label>
                <select id="operationMode" class="form-control">
                  <option value="auto">Otomatis (Ikuti Jam)</option>
                  <option value="manual">Manual</option>
                </select>
              </div>
            </div>

            <!-- Store Hours Card -->
            <div class="card">
              <h2><i class="fas fa-clock"></i> Jam Operasional</h2>
              <div class="form-group">
                <label>Buka</label>
                <input
                  type="time"
                  id="openTime"
                  value="08:00"
                  class="form-control"
                />
              </div>
              <div class="form-group">
                <label>Tutup</label>
                <input
                  type="time"
                  id="closeTime"
                  value="17:00"
                  class="form-control"
                />
              </div>
              <button id="saveHoursBtn" class="toggle-btn" style="width: 100%">
                <i class="fas fa-save"></i> Simpan Jam
              </button>
            </div>

            <!-- Stats Card -->
            <div class="card stats-card">
              <h2><i class="fas fa-chart-bar"></i> Statistik</h2>
              <div class="stats-main" id="totalMenus">0</div>
              <div class="stats-label">Total Menu Tersedia</div>
              <div class="stats-details">
                <div class="stat-item">
                  <div class="stat-value positive" id="activeMenus">0</div>
                  <div class="stat-label">Aktif</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value negative" id="outOfStock">0</div>
                  <div class="stat-label">Habis</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Stats -->
          <div class="card">
            <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
              <button class="toggle-btn" style="background: var(--gradient-secondary);" onclick="showPage('menus')">
                <i class="fas fa-plus"></i> Tambah Menu
              </button>
              <button class="toggle-btn" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);" onclick="alert('Fitur akan datang!')">
                <i class="fas fa-chart-line"></i> Lihat Report
              </button>
              <button class="toggle-btn" style="background: linear-gradient(135deg, #17a2b8 0%, #0dcaf0 100%);" onclick="showPage('store')">
                <i class="fas fa-cog"></i> Pengaturan
              </button>
            </div>
          </div>
        </div>

        <!-- MENUS PAGE -->
        <div id="pageMenus" class="page" style="display: none">
          <div class="header">
            <h1><i class="fas fa-utensils"></i> Kelola Menu</h1>
            <p class="subtitle">Kelola menu makanan dan minuman warung</p>
          </div>

          <div class="card">
            <h2><i class="fas fa-list"></i> Daftar Menu</h2>

            <div id="menusAlert" class="alert" style="display: none"></div>

            <div class="table-container">
              <table id="menusTable">
                <thead>
                  <tr>
                    <th>Nama</th>
                    <th>Kategori</th>
                    <th>Harga</th>
                    <th>Stok</th>
                    <th>Status</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="menusTableBody">
                  <tr>
                    <td colspan="6" class="loading">
                      <i class="fas fa-spinner fa-spin"></i><br />
                      Loading menu...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Add Menu Form -->
            <div class="add-menu-form">
              <h3><i class="fas fa-plus-circle"></i> Tambah Menu Baru</h3>

              <div class="form-grid">
                <div class="form-group">
                  <label>Nama Menu</label>
                  <input
                    type="text"
                    id="menuName"
                    class="form-control"
                    placeholder="Nasi Goreng Seafood"
                    required
                  />
                </div>

                <div class="form-group">
                  <label>Kategori</label>
                  <select id="menuCategory" class="form-control" required>
                    <option value="seblak">Seblak</option>
                    <option value="gorengan">Gorengan</option>
                    <option value="minuman">Minuman</option>
                    <option value="snack">Snack</option>
                  </select>
                </div>

                <div class="form-group">
                  <label>Harga (Rp)</label>
                  <input
                    type="number"
                    id="menuPrice"
                    class="form-control"
                    placeholder="15000"
                    min="0"
                    required
                  />
                </div>

                <div class="form-group">
                  <label>Stok</label>
                  <input
                    type="number"
                    id="menuStock"
                    class="form-control"
                    placeholder="50"
                    min="0"
                    required
                  />
                </div>

                <!-- Gambar Menu - Upload File -->
                <div class="form-group">
                  <label>Gambar Menu</label>
                  <div class="image-options">
                    <div class="file-upload-container">
                      <button
                        type="button"
                        id="chooseFileBtn"
                        class="file-upload-btn"
                      >
                        <i class="fas fa-cloud-upload-alt"></i> Upload Gambar
                      </button>
                      <input
                        type="file"
                        id="menuImageFile"
                        accept="image/*"
                        style="display: none"
                      />
                      <div id="fileName">Belum ada file dipilih</div>
                      <div class="upload-progress" id="uploadProgress">
                        <div class="progress-bar" id="progressBar">0%</div>
                      </div>
                      <div id="imagePreview" style="display: none">
                        <img id="previewImage" />
                      </div>
                    </div>

                    <div class="image-option-separator">atau</div>

                    <div>
                      <label>Gunakan URL Gambar</label>
                      <input
                        type="text"
                        id="menuImageUrl"
                        class="form-control"
                        placeholder="https://example.com/image.jpg"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-actions">
                <button id="addMenuBtn" class="btn-submit">
                  <i class="fas fa-plus"></i> Tambah Menu
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- STORE SETTINGS PAGE -->
        <div id="pageStore" class="page" style="display: none">
          <div class="header">
            <h1><i class="fas fa-cog"></i> Pengaturan Toko</h1>
            <p class="subtitle">Atur informasi dan pengaturan warung</p>
          </div>

          <div class="card">
            <h2><i class="fas fa-info-circle"></i> Informasi Toko</h2>
            <div id="storeAlert" class="alert" style="display: none"></div>

            <div class="form-group">
              <label>Nama Toko</label>
              <input
                type="text"
                id="storeName"
                value="Warung Habibie"
                class="form-control"
              />
            </div>

            <div class="form-group">
              <label>Deskripsi</label>
              <textarea id="storeDescription" rows="3" class="form-control">
Hangatnya seblak di setiap malammu. Pesan via WhatsApp, kami antar ke lokasimu.</textarea
              >
            </div>

            <div class="form-group">
              <label>Nomor WhatsApp</label>
              <input
                type="text"
                id="storeWhatsApp"
                value="082382733648"
                class="form-control"
              />
            </div>

            <div class="form-group">
              <label>Alamat</label>
              <textarea id="storeAddress" rows="2" class="form-control">
Dekat Seri Tj., Kec. Tj. Batu, Kabupaten Ogan Ilir, Sumatera Selatan 30664</textarea
              >
            </div>

            <button id="saveStoreInfoBtn" class="toggle-btn">
              <i class="fas fa-save"></i> Simpan Informasi
            </button>
          </div>
        </div>

        <!-- ORDERS PAGE (Placeholder) -->
        <div id="pageOrders" class="page" style="display: none">
          <div class="header">
            <h1><i class="fas fa-shopping-cart"></i> Manajemen Pesanan</h1>
            <p class="subtitle">Kelola pesanan pelanggan</p>
          </div>

          <div class="card">
            <h2><i class="fas fa-clipboard-list"></i> Daftar Pesanan</h2>
            <div class="loading">
              <i class="fas fa-tools"></i><br />
              <h3 style="margin: 20px 0 10px; color: var(--primary);">Fitur Sedang Dalam Pengembangan</h3>
              <p style="color: var(--gray); max-width: 500px; margin: 0 auto;">
                Fitur manajemen pesanan yang lengkap akan segera hadir. Saat ini semua pesanan langsung ke WhatsApp.
              </p>
              <div style="margin-top: 30px;">
                <button class="toggle-btn" onclick="window.open('https://wa.me/6282382733648', '_blank')">
                  <i class="fab fa-whatsapp"></i> Buka WhatsApp
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- ANALYTICS PAGE (Placeholder) -->
        <div id="pageAnalytics" class="page" style="display: none">
          <div class="header">
            <h1><i class="fas fa-chart-line"></i> Analytics</h1>
            <p class="subtitle">Analisis data dan performa warung</p>
          </div>

          <div class="card">
            <h2><i class="fas fa-chart-pie"></i> Statistik Penjualan</h2>
            <div class="loading">
              <i class="fas fa-chart-line"></i><br />
              <h3 style="margin: 20px 0 10px; color: var(--primary);">Analytics Dashboard</h3>
              <p style="color: var(--gray); max-width: 500px; margin: 0 auto;">
                Fitur analytics akan segera hadir untuk membantu Anda menganalisis penjualan dan performa warung.
              </p>
              <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
                <div class="stat-item">
                  <div class="stat-value" style="color: var(--primary);">0</div>
                  <div class="stat-label">Total Penjualan</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value" style="color: var(--success);">0</div>
                  <div class="stat-label">Menu Populer</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- EDIT MENU MODAL -->
    <div id="editMenuModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-edit"></i> Edit Menu</h3>
          <button class="btn-close" id="closeEditModal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="editMenuForm">
            <input type="hidden" id="editMenuId" />

            <div class="form-group">
              <label>Nama Menu</label>
              <input
                type="text"
                id="editMenuName"
                class="form-control"
                required
              />
            </div>

            <div class="form-group">
              <label>Kategori</label>
              <select id="editMenuCategory" class="form-control" required>
                <option value="seblak">Seblak</option>
                <option value="gorengan">Gorengan</option>
                <option value="minuman">Minuman</option>
                <option value="snack">Snack</option>
              </select>
            </div>

            <div class="form-group">
              <label>Harga (Rp)</label>
              <input
                type="number"
                id="editMenuPrice"
                class="form-control"
                required
              />
            </div>

            <div class="form-group">
              <label>Stok</label>
              <input
                type="number"
                id="editMenuStock"
                class="form-control"
                required
              />
            </div>

            <!-- Gambar Menu Edit - Upload File -->
            <div class="form-group">
              <label>Gambar Menu</label>
              <div class="image-options">
                <div class="file-upload-container">
                  <button
                    type="button"
                    id="editChooseFileBtn"
                    class="file-upload-btn"
                  >
                    <i class="fas fa-cloud-upload-alt"></i> Upload Gambar Baru
                  </button>
                  <input
                    type="file"
                    id="editMenuImageFile"
                    accept="image/*"
                    style="display: none"
                  />
                  <div id="editFileName">Pilih file untuk mengganti gambar</div>
                  <div class="upload-progress" id="editUploadProgress">
                    <div class="progress-bar" id="editProgressBar">0%</div>
                  </div>
                  <div id="editImagePreview" style="display: none">
                    <img id="editPreviewImage" />
                  </div>
                </div>

                <div class="image-option-separator">atau</div>

                <div>
                  <label>Gunakan URL Gambar</label>
                  <input
                    type="text"
                    id="editMenuImageUrl"
                    class="form-control"
                    placeholder="https://example.com/image.jpg"
                  />
                  <div
                    id="currentImagePreview"
                    style="margin-top: 10px; display: none"
                  >
                    <small>Gambar Saat Ini:</small><br />
                    <img
                      id="currentImage"
                      style="
                        max-width: 150px;
                        max-height: 150px;
                        border-radius: 5px;
                        margin-top: 5px;
                      "
                    />
                  </div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label>Status</label>
              <select id="editMenuStatus" class="form-control">
                <option value="true">Aktif</option>
                <option value="false">Nonaktif</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            id="cancelEditBtn"
            class="toggle-btn"
            style="background: #666"
          >
            Batal
          </button>
          <button id="saveEditBtn" class="toggle-btn">Simpan Perubahan</button>
        </div>
      </div>
    </div>

    <script>
      // =================== KONFIGURASI SUPABASE ===================
      const SUPABASE_URL = "https://eumouuwgmayjyagqxgti.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV1bW91dXdnbWF5anlhZ3F4Z3RpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0MDkzNzAsImV4cCI6MjA4NTk4NTM3MH0.B9wihoEOoo2hCbAVbr1q446HUxdHrgFGtPhKRhfVVAQ";

      // =================== INISIALISASI SUPABASE ===================
      const supabaseAdmin = window.supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY,
      );

      // =================== VARIABEL GLOBAL ===================
      let storeSettings = null;
      let menus = [];
      let currentEditingMenu = null;

      // =================== ELEMENT REFERENCES ===================
      // Mobile Elements
      const mobileMenuBtn = document.getElementById("mobileMenuBtn");
      const sidebar = document.getElementById("sidebar");

      // Dashboard Elements
      const dashboardAlert = document.getElementById("dashboardAlert");
      const currentMode = document.getElementById("currentMode");

      // Store Status Elements
      const currentStatus = document.getElementById("currentStatus");
      const toggleStatusBtn = document.getElementById("toggleStatusBtn");
      const operationMode = document.getElementById("operationMode");
      const openTime = document.getElementById("openTime");
      const closeTime = document.getElementById("closeTime");
      const saveHoursBtn = document.getElementById("saveHoursBtn");

      // Menu Elements
      const menusTableBody = document.getElementById("menusTableBody");
      const addMenuBtn = document.getElementById("addMenuBtn");
      const menuName = document.getElementById("menuName");
      const menuCategory = document.getElementById("menuCategory");
      const menuPrice = document.getElementById("menuPrice");
      const menuStock = document.getElementById("menuStock");
      const menuImageUrl = document.getElementById("menuImageUrl");
      const menusAlert = document.getElementById("menusAlert");

      // File Upload Elements (Add Menu)
      const menuImageFile = document.getElementById("menuImageFile");
      const chooseFileBtn = document.getElementById("chooseFileBtn");
      const fileName = document.getElementById("fileName");
      const imagePreview = document.getElementById("imagePreview");
      const previewImage = document.getElementById("previewImage");
      const uploadProgress = document.getElementById("uploadProgress");
      const progressBar = document.getElementById("progressBar");

      // File Upload Elements (Edit Menu)
      const editMenuImageFile = document.getElementById("editMenuImageFile");
      const editChooseFileBtn = document.getElementById("editChooseFileBtn");
      const editFileName = document.getElementById("editFileName");
      const editImagePreview = document.getElementById("editImagePreview");
      const editPreviewImage = document.getElementById("editPreviewImage");
      const editUploadProgress = document.getElementById("editUploadProgress");
      const editProgressBar = document.getElementById("editProgressBar");
      const editMenuImageUrl = document.getElementById("editMenuImageUrl");
      const currentImagePreview = document.getElementById(
        "currentImagePreview",
      );
      const currentImage = document.getElementById("currentImage");

      // Stats Elements
      const totalMenus = document.getElementById("totalMenus");
      const activeMenus = document.getElementById("activeMenus");
      const outOfStock = document.getElementById("outOfStock");

      // Store Info Elements
      const saveStoreInfoBtn = document.getElementById("saveStoreInfoBtn");
      const storeAlert = document.getElementById("storeAlert");

      // Modal Elements
      const editMenuModal = document.getElementById("editMenuModal");
      const closeEditModal = document.getElementById("closeEditModal");
      const cancelEditBtn = document.getElementById("cancelEditBtn");
      const saveEditBtn = document.getElementById("saveEditBtn");
      const editMenuForm = document.getElementById("editMenuForm");

      // Navigation Elements
      const navLinks = document.querySelectorAll(".nav-menu a");
      const pages = document.querySelectorAll(".page");

      // =================== FUNGSI UTILITAS ===================
      function showAlert(element, message, type = "success") {
        if (!element) return;

        element.textContent = message;
        element.className = `alert alert-${type}`;
        element.style.display = "block";

        setTimeout(() => {
          element.style.display = "none";
        }, 4000);
      }

      function showProgressBar(element, progress, text) {
        if (element) {
          element.style.width = `${progress}%`;
          element.textContent = text || `${Math.round(progress)}%`;
        }
      }

      function showPage(pageName) {
        // Update active nav
        navLinks.forEach((l) => l.classList.remove("active"));
        document.querySelector(`.nav-menu a[data-page="${pageName}"]`).classList.add("active");

        // Show selected page
        pages.forEach((p) => (p.style.display = "none"));
        const pageElement = document.getElementById(
          `page${pageName.charAt(0).toUpperCase() + pageName.slice(1)}`,
        );
        if (pageElement) {
          pageElement.style.display = "block";
        }

        // Close mobile sidebar
        if (window.innerWidth <= 1024 && sidebar) {
          sidebar.classList.remove("mobile-open");
        }
      }

      // =================== MOBILE MENU HANDLING ===================
      function initMobileMenu() {
        if (!mobileMenuBtn || !sidebar) return;

        // Toggle sidebar
        mobileMenuBtn.addEventListener("click", () => {
          sidebar.classList.toggle("mobile-open");
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener("click", (e) => {
          if (
            window.innerWidth <= 1024 &&
            !sidebar.contains(e.target) &&
            e.target !== mobileMenuBtn &&
            !e.target.closest(".mobile-menu-btn")
          ) {
            sidebar.classList.remove("mobile-open");
          }
        });

        // Close sidebar when clicking a nav link on mobile
        navLinks.forEach((link) => {
          link.addEventListener("click", () => {
            if (window.innerWidth <= 1024) {
              sidebar.classList.remove("mobile-open");
            }
          });
        });
      }

      // =================== FILE UPLOAD HANDLING ===================
      function initFileUpload() {
        // Add Menu File Upload
        if (chooseFileBtn && menuImageFile) {
          chooseFileBtn.addEventListener("click", () => {
            menuImageFile.click();
          });

          menuImageFile.addEventListener("change", handleFileSelect);
        }

        // Edit Menu File Upload
        if (editChooseFileBtn && editMenuImageFile) {
          editChooseFileBtn.addEventListener("click", () => {
            editMenuImageFile.click();
          });

          editMenuImageFile.addEventListener("change", handleEditFileSelect);
        }
      }

      function handleFileSelect(e) {
        const file = e.target.files[0];
        if (file) {
          validateAndPreviewFile(file, fileName, previewImage, imagePreview);

          // Clear URL input
          menuImageUrl.value = "";
        }
      }

      function handleEditFileSelect(e) {
        const file = e.target.files[0];
        if (file) {
          validateAndPreviewFile(
            file,
            editFileName,
            editPreviewImage,
            editImagePreview,
          );

          // Clear URL input
          editMenuImageUrl.value = "";
        }
      }

      function validateAndPreviewFile(
        file,
        fileNameElement,
        previewElement,
        previewContainer,
      ) {
        // Validate file type
        if (!file.type.match("image.*")) {
          showAlert(menusAlert, "Hanya file gambar yang diizinkan (JPEG, PNG, GIF, WebP, dll.)", "error");
          return;
        }

        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
          showAlert(menusAlert, "Ukuran file maksimal 5MB", "error");
          return;
        }

        // Update file name display
        fileNameElement.textContent = file.name;

        // Show preview
        const reader = new FileReader();
        reader.onload = (e) => {
          previewElement.src = e.target.result;
          previewContainer.style.display = "block";
        };
        reader.readAsDataURL(file);
      }

      // =================== UPLOAD TO SUPABASE STORAGE ===================
      async function uploadImageToStorage(file, progressCallback = null) {
        try {
          console.log(" Uploading image to Supabase Storage...");

          // Generate unique filename
          const fileExt = file.name.split(".").pop();
          const fileName = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}.${fileExt}`;
          const filePath = `menu-images/${fileName}`;

          // Upload file to Supabase Storage
          const { data, error } = await supabaseAdmin.storage
            .from("menu-images")
            .upload(filePath, file, {
              cacheControl: "3600",
              upsert: false,
            });

          if (error) throw error;

          console.log(" Image uploaded successfully:", data);

          // Get public URL
          const { data: urlData } = supabaseAdmin.storage
            .from("menu-images")
            .getPublicUrl(filePath);

          return urlData.publicUrl;
        } catch (error) {
          console.error(" Error uploading image:", error);
          throw error;
        }
      }

      // =================== LOAD DATA ===================
      async function loadDashboardData() {
        try {
          console.log(" Loading dashboard data...");

          await loadStoreSettings();
          await loadMenus();
          updateStats();

          console.log(" Dashboard data loaded successfully");
        } catch (error) {
          console.error(" Error loading dashboard data:", error);
          showAlert(dashboardAlert, "Gagal memuat data dashboard", "error");
        }
      }

      async function loadStoreSettings() {
        try {
          const { data, error } = await supabaseAdmin
            .from("store_settings")
            .select("*")
            .single();

          if (error) throw error;

          storeSettings = data;
          updateStoreUI();
        } catch (error) {
          console.error(" Error loading store settings:", error);
          throw error;
        }
      }

      async function loadMenus() {
        try {
          const { data, error } = await supabaseAdmin
            .from("menus")
            .select("*")
            .order("created_at", { ascending: false });

          if (error) throw error;

          menus = data || [];
          renderMenusTable();
        } catch (error) {
          console.error(" Error loading menus:", error);
          throw error;
        }
      }

      // =================== RENDER FUNCTIONS ===================
      function updateStoreUI() {
        if (!storeSettings) return;

        const isOpen = storeSettings.is_open;
        const isManual = storeSettings.manual_override;

        // Update status indicator
        currentStatus.textContent = isOpen ? "BUKA" : "TUTUP";
        currentStatus.className = `status-indicator ${isOpen ? "status-open" : "status-closed"}`;

        // Update toggle button
        toggleStatusBtn.innerHTML = `<i class="fas fa-power-off"></i> ${isOpen ? "Tutup Toko" : "Buka Toko"}`;
        toggleStatusBtn.style.background = isOpen 
          ? "linear-gradient(135deg, #f44336 0%, #d32f2f 100%)"
          : "var(--gradient-primary)";

        // Update mode text
        currentMode.textContent = isManual ? "Manual" : "Otomatis";
        operationMode.value = isManual ? "manual" : "auto";

        // Update time inputs
        openTime.value = storeSettings.open_time
          ? storeSettings.open_time.substring(0, 5)
          : "08:00";
        closeTime.value = storeSettings.close_time
          ? storeSettings.close_time.substring(0, 5)
          : "17:00";
      }

      function renderMenusTable() {
        if (!menusTableBody) return;

        if (!menus.length) {
          menusTableBody.innerHTML = `
              <tr>
                  <td colspan="6" style="text-align: center; padding: 60px 20px; color: var(--gray);">
                      <i class="fas fa-utensils" style="font-size: 3rem; margin-bottom: 15px; color: var(--primary); opacity: 0.5;"></i><br>
                      <h3 style="color: var(--dark); margin-bottom: 10px;">Belum ada menu</h3>
                      <p>Tambah menu pertama Anda dengan form di bawah!</p>
                  </td>
              </tr>
          `;
          return;
        }

        menusTableBody.innerHTML = "";

        menus.forEach((menu) => {
          const row = document.createElement("tr");

          // Determine stock badge
          let stockBadge = "";
          if (menu.stock === 0) {
            stockBadge = '<span class="stock-badge stock-out">HABIS</span>';
          } else if (menu.stock <= 10) {
            stockBadge = `<span class="stock-badge stock-low">${menu.stock} tersisa</span>`;
          } else {
            stockBadge = `<span class="stock-badge stock-ok">${menu.stock} tersisa</span>`;
          }

          row.innerHTML = `
              <td>
                  <div style="display: flex; align-items: center; gap: 12px;">
                      ${menu.image_url ? `<img src="${menu.image_url}" style="width: 40px; height: 40px; border-radius: 8px; object-fit: cover;">` : '<div style="width: 40px; height: 40px; border-radius: 8px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; color: white;"><i class="fas fa-utensils"></i></div>'}
                      <div>
                          <strong>${menu.name}</strong>
                          ${!menu.is_active ? '<div style="font-size: 0.8rem; color: var(--danger);">(Nonaktif)</div>' : ""}
                      </div>
                  </div>
              </td>
              <td><span style="padding: 4px 12px; background: ${menu.category === 'seblak' ? 'rgba(255, 107, 53, 0.1)' : menu.category === 'gorengan' ? 'rgba(255, 193, 7, 0.1)' : 'rgba(108, 99, 255, 0.1)'}; color: ${menu.category === 'seblak' ? 'var(--primary)' : menu.category === 'gorengan' ? '#ffc107' : 'var(--secondary)'}; border-radius: 20px; font-size: 0.85rem; font-weight: 500;">${menu.category === "seblak" ? "Seblak" : menu.category === "gorengan" ? "Gorengan" : menu.category === "minuman" ? "Minuman" : "Snack"}</span></td>
              <td><strong style="color: var(--primary);">Rp ${menu.price.toLocaleString("id-ID")}</strong></td>
              <td>${stockBadge}</td>
              <td><span style="padding: 4px 12px; background: ${menu.is_active ? 'rgba(40, 167, 69, 0.1)' : 'rgba(220, 53, 69, 0.1)'}; color: ${menu.is_active ? 'var(--success)' : 'var(--danger)'}; border-radius: 20px; font-size: 0.85rem; font-weight: 500;">${menu.is_active ? "Aktif" : "Nonaktif"}</span></td>
              <td>
                  <div class="action-buttons">
                      <button class="btn-edit" data-id="${menu.id}">
                          <i class="fas fa-edit"></i> Edit
                      </button>
                      <button class="btn-delete" data-id="${menu.id}">
                          <i class="fas fa-trash"></i> Hapus
                      </button>
                  </div>
              </td>
          `;

          menusTableBody.appendChild(row);
        });

        // Add event listeners to edit/delete buttons
        document.querySelectorAll(".btn-edit").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const menuId = e.target.closest("button").dataset.id;
            openEditModal(menuId);
          });
        });

        document.querySelectorAll(".btn-delete").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const menuId = e.target.closest("button").dataset.id;
            deleteMenu(menuId);
          });
        });
      }

      function updateStats() {
        const total = menus.length;
        const active = menus.filter((m) => m.is_active).length;
        const out = menus.filter((m) => m.stock === 0).length;

        totalMenus.textContent = total;
        activeMenus.textContent = active;
        outOfStock.textContent = out;
      }

      // =================== CRUD OPERATIONS ===================
      // Store Status Operations
      async function toggleStoreStatus() {
        if (!storeSettings) return;

        const newStatus = !storeSettings.is_open;

        try {
          const { error } = await supabaseAdmin
            .from("store_settings")
            .update({
              is_open: newStatus,
              manual_override: true,
            })
            .eq("id", storeSettings.id);

          if (error) throw error;

          storeSettings.is_open = newStatus;
          storeSettings.manual_override = true;
          updateStoreUI();
          showAlert(
            dashboardAlert,
            `Status toko berhasil diubah menjadi ${newStatus ? "BUKA" : "TUTUP"}`,
            "success",
          );
        } catch (error) {
          console.error(" Error toggling store status:", error);
          showAlert(dashboardAlert, "Gagal mengubah status toko", "error");
        }
      }

      async function saveStoreHours() {
        if (!storeSettings) return;

        const openTimeValue = openTime.value + ":00";
        const closeTimeValue = closeTime.value + ":00";

        try {
          const { error } = await supabaseAdmin
            .from("store_settings")
            .update({
              open_time: openTimeValue,
              close_time: closeTimeValue,
              manual_override: operationMode.value === "manual",
            })
            .eq("id", storeSettings.id);

          if (error) throw error;

          storeSettings.open_time = openTimeValue;
          storeSettings.close_time = closeTimeValue;
          storeSettings.manual_override = operationMode.value === "manual";

          updateStoreUI();
          showAlert(
            dashboardAlert,
            "Jam operasional berhasil disimpan",
            "success",
          );
        } catch (error) {
          console.error(" Error saving store hours:", error);
          showAlert(dashboardAlert, "Gagal menyimpan jam operasional", "error");
        }
      }

      // Menu Operations
      async function addMenu() {
        if (!menuName.value || !menuPrice.value || !menuStock.value) {
          showAlert(menusAlert, "Harap isi semua field yang wajib", "error");
          return;
        }

        // Disable button during upload
        const originalText = addMenuBtn.innerHTML;
        addMenuBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Menyimpan...';
        addMenuBtn.disabled = true;

        try {
          let imageUrl = null;

          // Check if file is uploaded
          if (menuImageFile.files[0]) {
            // Show progress bar
            uploadProgress.style.display = "block";
            showProgressBar(progressBar, 10, "Mengunggah...");

            // Upload image to Supabase Storage
            imageUrl = await uploadImageToStorage(menuImageFile.files[0]);

            showProgressBar(progressBar, 100, "Selesai!");
            setTimeout(() => {
              uploadProgress.style.display = "none";
              showProgressBar(progressBar, 0, "0%");
            }, 1000);
          }
          // Check if URL is provided
          else if (menuImageUrl.value) {
            imageUrl = menuImageUrl.value;
          }

          const newMenu = {
            name: menuName.value,
            category: menuCategory.value,
            price: parseInt(menuPrice.value),
            stock: parseInt(menuStock.value),
            image_url: imageUrl,
            is_active: true,
          };

          console.log(" Adding menu:", newMenu);

          const { error } = await supabaseAdmin.from("menus").insert([newMenu]);

          if (error) throw error;

          showAlert(menusAlert, "Menu berhasil ditambahkan", "success");

          // Reset form
          menuName.value = "";
          menuPrice.value = "";
          menuStock.value = "";
          menuImageFile.value = "";
          menuImageUrl.value = "";
          fileName.textContent = "Belum ada file dipilih";
          imagePreview.style.display = "none";

          // Reload menus
          await loadMenus();
          updateStats();
        } catch (error) {
          console.error(" Error adding menu:", error);
          showAlert(
            menusAlert,
            "Gagal menambah menu: " + error.message,
            "error",
          );
        } finally {
          // Re-enable button
          addMenuBtn.innerHTML = '<i class="fas fa-plus"></i> Tambah Menu';
          addMenuBtn.disabled = false;
        }
      }

      function openEditModal(menuId) {
        const menu = menus.find((m) => m.id == menuId);
        if (!menu) return;

        currentEditingMenu = menu;

        // Fill form
        document.getElementById("editMenuId").value = menu.id;
        document.getElementById("editMenuName").value = menu.name;
        document.getElementById("editMenuCategory").value = menu.category;
        document.getElementById("editMenuPrice").value = menu.price;
        document.getElementById("editMenuStock").value = menu.stock;
        document.getElementById("editMenuImageUrl").value =
          menu.image_url || "";
        document.getElementById("editMenuStatus").value = menu.is_active;

        // Show current image if exists
        if (menu.image_url) {
          currentImage.src = menu.image_url;
          currentImagePreview.style.display = "block";
        } else {
          currentImagePreview.style.display = "none";
        }

        // Reset file inputs
        editMenuImageFile.value = "";
        editFileName.textContent = "Pilih file untuk mengganti gambar";
        editImagePreview.style.display = "none";

        // Show modal
        editMenuModal.classList.add("show");

        // Close mobile sidebar if open
        if (sidebar) {
          sidebar.classList.remove("mobile-open");
        }
      }

      function closeEditModalFunc() {
        editMenuModal.classList.remove("show");
        currentEditingMenu = null;
        editMenuForm.reset();

        // Reset previews
        currentImagePreview.style.display = "none";
        editImagePreview.style.display = "none";
        editFileName.textContent = "Pilih file untuk mengganti gambar";
      }

      async function saveEditMenu() {
        if (!currentEditingMenu) return;

        // Disable button during upload
        const originalText = saveEditBtn.innerHTML;
        saveEditBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Menyimpan...';
        saveEditBtn.disabled = true;

        try {
          let imageUrl = editMenuImageUrl.value || null;

          // Check if new file is uploaded
          if (editMenuImageFile.files[0]) {
            // Show progress bar
            editUploadProgress.style.display = "block";
            showProgressBar(editProgressBar, 10, "Mengunggah...");

            imageUrl = await uploadImageToStorage(editMenuImageFile.files[0]);

            showProgressBar(editProgressBar, 100, "Selesai!");
            setTimeout(() => {
              editUploadProgress.style.display = "none";
              showProgressBar(editProgressBar, 0, "0%");
            }, 1000);
          }

          const updatedMenu = {
            name: document.getElementById("editMenuName").value,
            category: document.getElementById("editMenuCategory").value,
            price: parseInt(document.getElementById("editMenuPrice").value),
            stock: parseInt(document.getElementById("editMenuStock").value),
            image_url: imageUrl,
            is_active:
              document.getElementById("editMenuStatus").value === "true",
          };

          const { error } = await supabaseAdmin
            .from("menus")
            .update(updatedMenu)
            .eq("id", currentEditingMenu.id);

          if (error) throw error;

          showAlert(menusAlert, "Menu berhasil diperbarui", "success");
          closeEditModalFunc();
          await loadMenus();
          updateStats();
        } catch (error) {
          console.error(" Error updating menu:", error);
          showAlert(menusAlert, "Gagal mengedit menu", "error");
        } finally {
          // Re-enable button
          saveEditBtn.innerHTML = "Simpan Perubahan";
          saveEditBtn.disabled = false;
        }
      }

      async function deleteMenu(menuId) {
        if (!confirm("Apakah yakin ingin menghapus menu ini?")) return;

        // Soft delete dengan set is_active ke false
        try {
          const { error } = await supabaseAdmin
            .from("menus")
            .update({ is_active: false })
            .eq("id", menuId);

          if (error) throw error;

          showAlert(menusAlert, "Menu berhasil dihapus", "success");
          await loadMenus();
          updateStats();
        } catch (error) {
          console.error(" Error deleting menu:", error);
          showAlert(menusAlert, "Gagal menghapus menu", "error");
        }
      }

      // =================== EVENT LISTENERS ===================
      // Store Status
      if (toggleStatusBtn) {
        toggleStatusBtn.addEventListener("click", toggleStoreStatus);
      }

      if (saveHoursBtn) {
        saveHoursBtn.addEventListener("click", saveStoreHours);
      }

      // Menu Management
      if (addMenuBtn) {
        addMenuBtn.addEventListener("click", addMenu);
      }

      // Modal
      if (closeEditModal) {
        closeEditModal.addEventListener("click", closeEditModalFunc);
      }

      if (cancelEditBtn) {
        cancelEditBtn.addEventListener("click", closeEditModalFunc);
      }

      if (saveEditBtn) {
        saveEditBtn.addEventListener("click", saveEditMenu);
      }

      // Navigation
      navLinks.forEach((link) => {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          const page = link.dataset.page;
          showPage(page);
        });
      });

      // =================== INITIALIZATION ===================
      document.addEventListener("DOMContentLoaded", () => {
        console.log(" Admin Dashboard Initializing...");
        initMobileMenu();
        initFileUpload();
        loadDashboardData(); // Langsung load data tanpa login
      });
    </script>
  </body>
</html>
